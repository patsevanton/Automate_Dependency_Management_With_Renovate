https://www.youtube.com/watch?v=HbKIqK5L8-E

Введение

Управление зависимостями в проектах – это огромная боль.

Даже относительно простые проекты часто содержат множество различных зависимостей и множество версий различных пакетов, расположенных в проекте.

Эти пакеты постоянно обновляются не только для того, чтобы предлагать новые функции, но и для устранения уязвимостей, которые появляются в этих пакетах с течением времени.

Даже если вы занимаетесь всего лишь одним или двумя проектами, накладные расходы на это могут быстро стать значительными. Если у вас много проектов, проблема становится еще хуже.



К счастью, существуют отличные решения для автоматического исправления уязвимостей с помощью программы Renovate. Также что в этом видео мы рассмотрим программу Renovate и как она работает.

Установим его в проект на GitHub. Опробуем некоторые из огромного спектра предлагаемых им вариантов конфигурации и последние возможности для автоматического обновления этих уязвимостей.

Все в порядке. Давайте сразу перейдем к делу. Обновите бот, установив простое приложение GitHub в свой репозиторий GitHub. Вы также можете установить его прямо из интерфейса командной строки, даже если вы его используете самостоятельно.

Для этого видео мы будем использовать приложение GitHub, поэтому, как только приложение будет установлено и настроено, оно будет регулярно сканировать ваш репозиторий GitHub и просматривать ваши зависимости.

Посмотрите на версии всех различных пакетов, которые вы используете.

Если это новая версия, то будет отправлен запрос на обновление пакета.

Если вы чувствуете себя действительно храбрым, вы можете настроить этот запрос на вытягивание так, чтобы он автоматически объединялся. Это даст вам автономное управление уязвимостями. Но чтобы быть в полной безопасности, вы вероятно захотите проверить запрос на вытягивание перед слиянием на тот случай, если какая-то версия обновляется до чего-то такого, чего вы на самом деле не ожидали. Но все равно это довольно круто, что вы можете это сделать.

Мы начинаем начать с установки Renovate в репозиторий GitHub. Сейчас я нахожусь на странице бота Renovate. Если вы перейдете на эту страницу, то можете прокрутить страницу вниз и немного прочитать о некоторых высокоуровневых настройках бота Renovate.
Поскольку я его уже установил, у меня здесь есть кнопка с надписью «Настроить». Если вы впервые пользуетесь ботом Renovate, то здесь, скорее всего, будет написано «Установить». Нажмите на эту кнопку.

Возможно, вам придется ввести свой пароль от GitHub. Я введу его прямо сейчас. А затем мы перейдем на эту страницу и снова прокрутим ее вниз до конца. Здесь мы видим, что нам предлагается выбрать, в какой репозиторий мы хотим установить программу.

Я собираюсь установить ее в базовый репозиторий. А еще это хранилище, в котором я храню только для преподавания одного из моих других курсов. Так что это довольно простое хранилище в виде фрагментов кода Java, построенное с помощью maven.

Здесь должно быть несколько зависимостей, которые мы могли бы обновить. Нажмите кнопку «Сохранить» и на этом все. Это должен быть бот обновления, установленный во всех репозиториях.



Что мы можем сделать прямо сейчас? Мы можем проверить панель мониторинга бота обновления. Если мы нажмем на панель мониторинга в этом месте, то сможем увидеть все репозитории, в которые мы добавили бота обновления. Таким образом, мы сможем ознакомиться с основными принципами обеспечения безопасности.

Один из них был добавлен сюда изначально. А вот некоторые из верхних репозиторий, которые я добавил ранее.

Как только вы установите приложение Renovate, как только что мы сделали, оно вызовет pull request в этом репозитории, который будет содержать первоначальную конфигурацию. Давайте посмотрим на это прямо сейчас из репозитории. Если я перейду к запросам на извлечение, то увижу, что здесь есть запрос на извлечение для обновлений конфигураций.

Если я нажму на измененные файлы, то смогу сказать, что это и есть начальная конфигурация, которую он собирается добавить. Так что это не добавит слишком многого. Это просто добавление схемы и простое расширение у основания.

Если на этом этапе мы перейдем к документации по обновлению бота, мы сможем увидеть некоторых из различных вариантов конфигурации. И увидим, что вероятно существует сотни различных настроек, которые мы могли изменить здесь. Это дает нам огромные возможности для гибкости.

Стоит отметить, что программа Renovate в значительной степени работает прямо из коробки. Но здесь у вас есть масса вариаций конфигураций, которые вы также можете выбрать.

Для упрощения этого урока мы просто добавим три различные дополнительные конфигурации.

Итак, мы собираемся добавить заголовок PR-сообщения. Это приведет к тому, что мы просто добавим заголовок по умолчанию ко всем нашим запросам на извлечение данных.

Мы также собираемся добавить несколько меток. Именно эти метки появляются в запросе на извлечение данных по мере его возникновения.
А также мы добавим назначенных лиц по умолчанию.

И вот, что это даст. pull request будет назначен определенным пользователям GitHub.

Так что сейчас я возвращаюсь со своим запросом на извлечение и смотрю на страницу обновления. И вот, что я собираюсь сделать. Я просто отредактирую этот файл и заменю первоначальную конфигурацию. Я просто заменю его таким образом.

Давайте взглянем на то, что мы добавили. Итак, первое, что мы добавили вверху страницы, это заголовок для рекламы. Так что в верхней части каждого запроса на вытягивание мы поместим заголовок с надписью «Тестовые заголовки Джеймса». Мы также добавили функцию назначения по умолчанию. Так что я только что добавил сюда свое имя пользователя на GitHub. Таким образом, это означает, что все запросы на извлечение, поступающие в данный момент, будут назначены мне.

Я также добавил метку по умолчанию, поэтому я добавил метку зависимостей, тестовую метку dash, так что она будет назначена каждому запросу на извлечение, который будет поднят.

И если вы посмотрите чуть ниже, я также назначил некоторые правила пакета для того, чтобы в этих правилах будет обозначено, что они будут таргетировать запросы на вытягивание на основе шаблона, который мы предоставляем.

К примеру, я положил сюда один для докера. Так что если программа обнаружит докер в запросе на извлечение, она поставит метку «Тестовая метка докера». Так что это означало бы перезапись ярлыка теста на зависимость.

Я также добавил еще один ярлык для своего приложения здесь. А кроме того к нему добавится ярлык «Test-maven».
Вот и зафиксируйте эти изменения. Я собираюсь зафиксировать их непосредственно в этой ветке.

Мы возвращаемся к нашему запросу на извлечение данных. Теперь мы готовы объединить эту ветку воедино. Нажмите «Посмотреть изменения» и «Утвердить».

Наконец, мне нужно нажать «Объединить», вытащить, запросить и подтвердить слияние. Вот и все, что мы сделали за 8 месяцев: купили, установили и настроили.

Если вы немного посмотрите на диалог в запросе на извлечение, который мы только что объединили, там говорится, что обнаружен этот пакет, который является нашим файлом maven. И он показывает нам, чего мы можем ожидать.

Мы можем ожидать, что эти зависимости будут обновлены после того, как мы объединим и обновим их. Это также говорит о том, что pull request также будет ограничен максимум двумя часами, чтобы больше не переполнять нашу систему.

Теперь вы можете настроить эту функцию так, как хотите.

Если сейчас мы вернемся к нашему запросу на вытягивание, то увидим, что было выдвинуто несколько различных запросов на вытягивание. Давайте посмотрим на верхний запрос здесь и на то, что он собирается делать. Он просто обновит наш валидатор схемы Джейсона.
Мы собираемся его обновить с версии 5.2.0 на 5.3.0. А также он предоставит нам дополнительную информацию о каждой новой версии пакета в процентном соотношении к принятому и показатели, насколько хорошо он был протестирован.

Если мы посмотрим сюда, то мы увидим, что заголовок был добавлен в начало наших запросов на извлечение. Он также дал нам эту метку, которую мы указали, так что она перешла на метку тестирования зависимостей по умолчанию.

И мы также можем сказать, что pull request был автоматически назначен и моему пользователю. Если я посмотрю в файлах изменения, мы сможем их увидеть в PubMed или небольших датах. Эта версия автоматически обновилась для нас.

Хорошо, это выглядит неплохо.

Я собираюсь продолжить процесс слияния, поэтому я одобрю запрос на вытягивание, а затем нажму кнопку «Объединить запрос на вытягивание». Удалите эту ветку тоже, чтобы быть аккуратным.

И вот мы на месте. Ветка начала сливаться.

Теперь еще одна классная функция программы Renovate. Это панель управления зависимостями. Она позволяет вам управлять своими действиями по обновлению и отслеживать их.

Теперь она действительно работает. Добавляя проблему с GitHub в ваш репозиторий GitHub, сначала вам нужно 
убедиться, что у вас есть включенные проблемы.

На самом деле это одна из функций GitHub «Включить их». Поэтому чтобы убедиться, что они у нас включены, мы можем зайти в раздел «Настройки», чтобы убедиться, что мы находимся на вкладке «Общие». Прокрутите страницу вниз и убедитесь, что здесь поставлена галочка «Проблемы».

Если я перейду на вкладку «Проблемы», то увижу, что здесь у меня есть панель мониторинга зависимостей. И это дает нам немного больше информации о том, как работает программа Renovate.

Таким образом, она показывает нам все текущие открытые неудовлетворительные запросы, а также обнаруженные 
зависимости. Так что если вы посмотрите на maven в Pub, то увидите, что обнаружены зависимости для 
младшего. Будьте уверены, что Jackson также использует данную схему Jackson вокруг данных. Еще раз повторяю, это просто дает нам немного больше информации о том, как обновить то, что было настроено в нашем репозитории.

Поэтому прежде чем я объединю эти данные Jackson BI и PR, я мог бы попробовать посмотреть, смогу ли я изменить конфигурацию так, чтобы она изменила метку, если он обнаруживает уязвимость Jackson.

Я собираюсь перейти к своей основной кодовой базе. Я собираюсь открыть программу обновления программного обеспечения. Джейсон – вот конфигурационный файл.  Я собираюсь отредактировать это прямо сейчас.

Нажмите здесь на карандаш. И вот, что изменю. Я изменю док-станцию на Jackson. А затем изменю метку на текстовую метку Jackson. Я собираюсь зафиксировать эти изменения непосредственно в главной ветке. Все в порядке.

Эти изменения были зафиксированы. И сейчас мы проверяем их на соответствие шаблону Jackson. Это должно привести к его обновлению. У нас есть тестовая этикетка Jackson. Так что если я перейду к своему запросу на извлечение, то у меня еще будет старый запрос, потому что он все еще просматривает предыдущий pull request.

Я собираюсь вернуться на панель мониторинга зависимостей. А затем, установив этот флажок, запускаю обновление. Это должно еще раз запустить программу в хранилище.

Итак, через несколько секунд вы видите, что он снова распаковывается. Так что теперь обновление коробки должно быть снова запущено, чтобы еще оставалась та же надпись. Это pull request. Я собираюсь закрыть этот вопрос.

Если я нажму кнопку «Закрыть pull request», я просто удалю эту ветку тоже.

Теперь у нас нет никаких запросов на извлечение.

Я снова вернусь к панели мониторинга зависимостей. Я еще раз поставлю галочку в поле «Обновить». И я вижу здесь сообщение о том, что это обновление заблокировано существующим закрытым PR и не будет восстановлено повторно, если вы не установите флажок ниже. Давайте установим этот флажок.

Через несколько секунд флажок исчезнет.

Я возвращаюсь к запросу на вытягивание и вижу, что на этот раз был сделан новый запрос на вытягивание. И на этот раз у нас есть ярлык с надписью «Jackson test-label». Наша конфигурация работает. Это действительно здорово!

Мы собираемся обновить версию с 2.13.4.2 на 2.14.2. Ей исполнилось всего 4 дня. И после проверки двух файлов у вас будет 10 % на ее одобрение. Мы ее можем посмотреть здесь. Это всего лишь обновление версии.

Я одобрю эти изменению и объединю pull request данных. Если я еще раз посмотрю на панель мониторинга зависимостей, то увижу, что следующая зависимость, которую мне будет предложено обновить, будет обновлена до версии 5.3.0. Но данный момент этот запрос на вытягивание не поднимался из-за установленного лимита.

Поскольку мы уже объединили два пути, ему придется подождать час прежде, чем он поднимет еще один.

Но если я поставлю этот флажок прямо сейчас, это должно привести к принудительному их созданию прямо сейчас. Так что через несколько секунд флажок будет снят.

Если я буду выполнять запросы на извлечение, то теперь у меня есть обновление зависимостей для rest-assured v5.3.0. Этому обновлению 76 дней. И у него есть высокая степень уверенности в том, что 100 % тестов будут пройдены успешно. Это выглядит очень хорошо.
Я собираюсь пойти дальше и обновить этот вариант. А также доказать, что он тоже хорошо. Я собираюсь одобрить этот запрос и объединить его.

Если я еще раз вернусь к панели мониторинга зависимостей, то мы увидим, что у нас больше нет обнаруженных зависимостей, которые нуждаются в обновлении.

Таким образом, теперь все, что находится в нашем хранилище, полностью обновлено.

Итак, в этом видео мы увидели, как легко добавить бота для обновления в свой репозиторий GitHub и получить 
возможность автоматического исправления уязвимостей. И я вам рекомендую это сделать.

Автоматизированное управление уязвимостями таким образом очень полезно. Отслеживание уязвимостей – это трудоемкий процесс, особенно если у вас много проектов, за которыми вы присматриваете. К тому же, добавить эту функцию было действительно просто. Бот для обновления фантастически работает прямо из коробки.

Небольшая настройка, которую мы проделали в этом видео, была сделана просто для того, чтобы показать некоторые из доступных опций. На самом деле в этом не было никакой необходимости. Я мог бы не делать этого, и это все равно работало удовлетворительным образом.

Если вам нужно провести дополнительную настройку, то в вашем распоряжении есть масса различных вариантов. Здесь есть буквально все. Вы даже можете настроить его так, чтобы он игнорировал определенные пакеты, если хотите. Если вы не хотите, чтобы что-то обновлялось или хотите изменить что-то еще, в конфигурации должна быть предусмотрена соответствующая опция.

Вы также можете создавать и размещать предустановки обновлений в хранилище. И все, что они позволяют вам сделать, это создать предустановку конфигурации бота обновления. И затем перенесите эту конфигурацию в множество различных репозиторий. Таким образом, вы управляете всей конфигурацией в одном месте. И это действительно мощная система!

Если вы хотите узнать больше о боте Renovate, я рекомендую ознакомиться с их документацией, а также с их сообществом на GitHub, которое действительно активное. 