https://www.youtube.com/watch?v=l0YH557eIiE
Automate Dependency Management With Renovate From Mend

А как вы справляетесь со своими зависимостями? Откуда вы знаете, что существует более новая версия какой-то зависимости? Когда вы обновляете свои зависимости, именно тогда вы обнаруживаете, что та или иная зависимость больше не поддерживается? Неужели именно тогда, когда она перестает работать? А, может быть, когда сканирование системы безопасности показывает вам, что существует мост? И что еще более важно, делаете ли вы это вручную? Вы переходите от одной зависимости к другой, а затем проверяете ее и периодически обновляете? Или у вас есть какая-то автоматизация?

Как насчет того, чтобы создать систему, которая будет создавать pull request с обновлениями для всех ваших зависимостей? А затем вы сможете выбрать – хотите ли вы обновить их все или некоторые из них. Это зависит только от вас.

Может быть, если вы наберетесь смелости, вам даже не нужны pull request, но вам хочется, чтобы ваши зависимости передавались непосредственно на основную линию? Именно об этом идет речь в этом видео.

Давайте посмотрим, как мы можем сделать этот небольшой ремонт.
Давайте взглянем на простой проект, который у меня есть. А ведь у меня не так уж много денег. У меня файлы Go. У меня есть Dockerfile для создания изображения контейнеров. И у меня есть каталог k8s, где хранятся мои манифесты Kubernetes. Все очень просто, насколько это вообще возможно.
Теперь в коде Go могут быть некоторые зависимости, которые могут быть актуальными, а, может быть, и нет.
В Dockerfile тоже могут быть некоторые зависимости. И в моих манифестах Kubernetes они тоже могут быть. Давайте посмотрим, смогу ли я  быть в курсе всех зависимостей, которые у меня есть в этом крошечном проекте.
Я буду использовать программу Renovate именно для этой цели.
Я уже записался на прием. Вам тоже стоит записать, если вы еще этого не сделали. И я собираюсь сразу приступить к выбору репозитория, к которым я хочу, чтобы компания Renovate управляла за меня.

Репозиторий, о котором идет речь, то самое, в котором хранятся файлы, называется «Renovate». Я сейчас его 
выберу и нажму на кнопку «Сохранить». Это все, что мне нужно сделать до тех пор, пока не начнется обновление, которое даст мне возможность выбрать то, что я хочу обновить, а что нет. Нажимайте на кнопку «Сохранить».

Я получил письмо по электронной почте. Давайте посмотрим, что находится внутри этого письма. Письмо пришло 
от компании Renovate, в котором говорится: «У тебя появилось новый репозиторий, за которым я слежу за тебя. 
Вот, что ты можешь с ним сделать, вот что произойдет в будущем». Это ознакомительное электронное письмо. Вам следует его прочесть. Я уже прочитал это письмо, так что я собираюсь двигаться дальше.
Двигаясь дальше, нажмите на ссылку с pull request, которое компания Renovate создала для нас. Это электронное письмо является содержимым pull request.
Давайте зайдем в раздел PR и посмотрим, что у нас там есть.
По сути дела, здесь говорится следующее: «У вас есть два типа обнаруженных файлов. Один из них относится к Dockerfile, а другой к Go. Именно там хранятся зависимости для языка Go. Это будет работать и с другими языками».
Вам необязательно использовать Go вместе с программой Renovate. Она работает практически с чем угодно.
Как ни странно, она не обнаружила мои манифесты Kubernetes, но мы вернемся к этому позже.
Давайте взглянем на файлы, которые были изменены с помощью этого pull request.
На самом деле существует только один способ обновления файла. Используйте формат json. Это настолько просто, насколько это возможно. В нем говорится, что он должен начать использовать программу Renovate и расширить базовую конфигурацию.
Мы можем ее подправить. И позже я дам советы и рекомендации по ее настройке, но это то, что поставляется по умолчанию. Большинству из нас нужны настройки по умолчанию. В этом и заключается одна из прелестей программы Renovate. Она просто работает из коробки. И опытные пользователи могут настроить ее в соответствии со своими собственными желаниями, но из коробки работает довольно хорошо. Для многих из нас нет необходимости что-либо менять.
Позвольте мне смержить этот Pull request и пусть игры начнутся. Давайте посмотрим, что у них получится.
Через несколько минут у меня появилась новая issue. Это не то же самое, что и другие проблемы, которые вы открываете на GitHub. Это не то же самое, что закрыть, а затем открыть новый вопрос.
Представьте себе, что это Dashboard. Так что это issue должна быть открыта постоянно. Renovate обновит эту issue, предоставив вам сводную информацию обо всех других обновлениях всех других pull request, которые она создаст для нас.
Поступило два pull request. Вы, наверное, догадались об этом с самого начала.
Один из них относится к библиотекам Go, а другой к Dockerfile. Так что первый pull request, который я открою, будет касаться Dockerfile. Я смогу увидеть краткое изложение и всю информацию, которая мне может понадобиться и т. д. Это очень информативно. Именно эта часть мне и нравится. И я пропущу все это, потому что я уже знаком с программой Renovate. И сразу перейду к файлам, которые были изменены.
Мы можем видеть, что это изменило базовые изображения.
В моем Dockerfile использовался Golang 1.17, а текущая версия 1.18. И он только что изменил Dockerfile. И 
все, что мне нужно сделать, это принять этот pull request, чтобы объединить его с основной веткой. И тогда 
любые pipeline, которые у меня есть, запустятся и создадут новый образ в этом случае, потому что Dockerfile изменился, и я буду жить долго и счастливо до следующего изменения.
А второй pull request касается зависимости Go. И процесс по-прежнему остается тем же самым.
У меня есть краткое изложение всех изменений в описании pull request. У меня есть примечание к выпуску и т. д. Я это тоже пропущу и сразу перейду к файлам, в которых были внесены изменения.
В результате была изменена только одна зависимость. Но давайте посмотрим, так ли это на самом деле.
А затем я перешел к различиям между тем, что было раньше и сейчас, сейчас и потом, и т. д. Только посмотрите на это. Это не простое изменение зависимости. Это действительно изменило одну из этих зависимостей. Но у этой зависимости есть и другие подзависимости, так что это изменило их все. Он сделал это разумно, понимая, что существуют зависимости от зависимостей и т. д. Поэтому он изменил режим Go, который содержит основные зависимости и изменил сумму Go, которая содержит все хэши всех конкретных зависимостей. Так что это изменило все разумно, а не просто слепо повлияло на одну из зависимостей.
Позвольте мне также объединить этот pull request и вернуться к своему терминалу.
У меня есть еще одна проблема, которую мне нужно исправить. Мне нужно выяснить, как я буду справляться со своими зависимостями от Kubernetes, с зависимостями в манифесте Kubernetes.
Но прежде чем я это сделаю, позвольте мне вытащить последнюю версию моего репозитория, потому что я только что создал зpull request. Объединил их и т. д.
И я вижу, что теперь у меня есть последняя версия моего Dockerfile, а также режим перехода и масштабирования и я могу работать с Kubernetes.
Теперь вы можете подумать: «Как получилось так, что программа обновления обнаружила, что у меня есть Dockerfile и что у меня есть зависимости Go?». Но это не так. Выясните, что существуют какие-то манифесты Kubernetes. Почему я должен специально сообщать компании Renovate о том, что существуют манифесты Kubernetes? И ответ на этот вопрос относительно прост – манифесты Kubernetes могут быть практически любыми и находиться практически в любом месте.
Для компании Renovate было бы пустой тратой времени сканировать весь репозиторий на предмет наличия всех файлов yaml. Для того чтобы разобраться в этом, вовсе необязательно использовать язык yaml. Так что это было бы большой тратой времени впустую.
И мне придется помочь в обновлении, сказав ему: «В этом конкретном каталоге содержится манифесты Kubernetes». Именно это я и собираюсь сделать.
Я собираюсь добавить новый раздел Kubernetes. И я собираюсь сказать ему: «Совпадение файлов – каталог 
Kubernetes. И все файлы yaml внутри этого каталога». Я собираюсь сохранить этот файл и отправить его обратно на GitHub.
А затем я подожду несколько минут. И смогу вернуться к этой проблеме, к панели мониторинга, которая хранится в проблеме. И мы увидим, что панель мониторинга изменилась. Теперь там написано: «Все зависимости, которые у тебя были раньше, исправлены. Но теперь у тебя возникла проблема в одном из манифестов Kubernetes».
Если быть более точным, было обнаружено, что тег изображения, который я использовал, не является последним. И все, что мне нужно сделать, это нажать на эту ссылку, которая приведет меня к pull request информации.
А внутри этого pull request у меня есть краткое изложение или вся информация о том, что происходит.
И я могу перейти к разделу «Изменения в файлах», чтобы просмотреть изменения в файлах и подробную информацию о том, что предлагает мне сделать программа Renovate. И это предложение относительно простое: «Изображение было вот таким». Теперь должно получиться так, что если вы объедините этот pull request, то получите тег изображения, который вы используете в манифесте развертывания Kubernetes.
Так что я доверяю программе Renovate. Я просто собираюсь объединить этот pull request данных воедино. И на этом все должно закончиться.
Но существует потенциальная проблема. Потенциальный недостаток в том, что делает компания Renovate или в масштабах того, что делает компания Renovate. И я могу продемонстрировать это в одном из файлов моего манифеста Kubernetes.
Позвольте мне вывести данные на языке yaml.
Если вы не знакомы с Kubernetes, не являетесь экспертом, вы можете сказать: «Это выглядит нормально». Но это не так, потому что горизонтальный модуль автоматического масштабирования использует старую версию v2beta1. И прямо сейчас у нас есть v2. Нам следовало бы использовать версию v2, готовую к стабильному производству, а не бета-версию, которую я использую сам.
И я надеялся, что тенденция развития IT-технологий также выявит эту зависимость и предложит мне изменить версию api этого конкретного ресурса Kubernetes. Но, к сожалению, это не входит в рамки программы Renovate.
На самом деле речь идет не об управлении зависимостями Kubernetes, а только о самих изображениях.
А теперь я мог бы спросить: «Разве это считается зависимостью?». Являются ли версии Kubernetes чем-то 
таким, чем должна управлять компания Renovate или нет? Библиотеки Go, которыми она управляют, являются библиотеками сторонних производителей. Их па тоже является сторонней компанией. В каком-то смысле это так. Так что это может быть частью сферы применения или я не уверен. В любом случае было бы очень здорово, если бы компания Renovate расширила сферу своей деятельности за пределы того, чем он занимается прямо сейчас.
А ведь он делает очень многое. Так что я на самом деле не жалуюсь. Я просто вижу возможность выйти за рамки этого. И это могут версии ресурсов Kubernetes. Это могут быть версии кластеров Kubernetes, доступные вам. Это могут быть версии операционных систем, если вы используете виртуальные машины и т. д. Здесь есть много возможностей для роста.
Если то, что вы получаете из коробки, недостаточно, как и в моем случае, мне пришлось добавить Kubernetes. Каталог, в котором Renovate должен отслеживать наличие моих ресурсов Kubernetes.
И вы можете расширить это гораздо дальше.
Если вы зайдете в раздел «Параметры конфигураций», то увидите все доступные перестановки, которые вы можете добавить к своему обновлению. Запишите файл в формате json и расширьте или точно настройте то, что он делает.
Если вы перейдете к обновлению платформ, мы увидим, что он поддерживает Bitbucket, GitHub и GitLab. По сути, там есть все часто используемые решения Git. Кроме того, у нас есть менеджеры. И это немного сбивает с толку.
Например, если вы посмотрите на приложение Docker, то увидите, что там есть приложение Ansible. На самом деле это действительно Docker. Docker сочиняет музыку. Все в порядке. Dockerfile имеет смысл. Как вам этот Docker& GitLab-аналитик и Kubernetes. Так что меня немного сбивает с толку то, как компания Renovate организует поддержку менеджеров.
Но что действительно важно, так это то, что там есть почти все, что вы можете использовать. Почти все различные манифесты, которые вы используете для определения материала. И у нас есть источники данных.
Источники данных очень важны, если вы хотите быть конкретным и рассказать компании Renovate, как найти версии, которая она должна искать и каковы правила, какие существуют фильтры и т. д. Таким образом, источники данных позволяют нам точно настроить то, как компания Renovate выбирает, какими должны быть обновления для наших зависимостей.
И также у нас есть языки, которые она поддерживает. На самом деле это не совсем языки: Bazel, Docker, Golang, Java, JavaScript, Node, Nuget, PHP, Python, Ruby.
И даже если вы не охвачены из коробки, вы можете расширить программу Renovate, создать свои собственные правила. Рассказать программе Renovate, как бороться с тем, что не поддерживается прямо из коробки.
Есть еще один важный вопрос: «А сколько это стоит? Сколько нужно заплатить, чтобы воспользоваться услугой Renovate?». У нас хорошие новости. Если вы занимаетесь проектом с открытым исходным кодом, то это абсолютно бесплатно. Если вы пользуетесь GitHub, то это тоже бесплатно. Если это самостоятельный проект, то он все равно остается бесплатным. Вам нужно получить лицензию на самостоятельный хостинг.
Я не использую самостоятельные компоненты, так что я не совсем уверен, что значит получить лицензию бесплатно, но это должно быть бесплатно, я уверен. В любом случае цена настолько хороша, насколько это возможно. Она равна нулю.
А теперь давайте поговорим о Renovate. Это приложение просто потрясающее! Это фантастика! Есть только один 
негативный момент. И это сфера применения. Я думаю, что Renovate должен идти гораздо дальше, чем он идет 
прямо сейчас. Я вижу, что в будущем компания Renovate будет управлять версиями api моих манифестов Kubernetes, управлять самими версиями Kubernetes, управлять версиями операционных систем. Это может зайти дальше, чем уже есть. Теоретически потенциально она может управлять любыми типами обновлений, которые вам могут потребоваться для любого типа ресурсов.
И если компания Renovate будет продолжать расти, то именно это мы вероятно увидим в недалеком будущем. Я на это надеюсь. Так что этот негативный момент на самом деле не является негативным. Здесь есть все возможности для совершенствования и расширения сферы применения.
Это просто работает. Все работает из коробки. Вы говорите: «Я хочу, чтобы ты управлял этим хранилищем». И в большинстве случаев все будет сделано правильно, даже если я ничего не буду предпринимать.
А если он будет делать не совсем то, что я хочу, я легко могу расширить его с помощью обновления json. Я могу точно настроить то, что он делает. Так что все работает так, как надо. Это просто работает. И поведение по умолчанию – это то, что действительно работает для большинства людей. Он очень легко настраивается, а цена у него самая подходящая – нулевая.
И позвольте дать вам рекомендацию: не полагайтесь только на компанию Renovate. Компания Renovate не позволит вам объединять pull request с основной линией всякий раз, когда происходит обновление.
Вам все равно нужны конвейеры, которые будут тестировать эти изменения и гарантировать, что все работает. Так что программа обновления дополняет вашу автоматизацию. Она гарантирует, что у вас будут pull request с обновлением ваших зависимостей или чего-то еще, чем она управляет. Она не заменяет собой вашу автоматизацию. Так что убедитесь, что вы тестируете свои обновления до того, как действительно примените их в производстве. 
