https://www.youtube.com/watch?v=l0YH557eIiE

Automate Dependency Management With Renovate From Mend

А как вы справляетесь со своими зависимостями? Откуда вы знаете, что существует более новая версия какой-то зависимости? Когда вы обновляете свои зависимости, именно тогда вы обнаруживаете, что та или иная зависимость больше не поддерживается? Неужели именно тогда, когда она перестает работать? А, может быть, когда сканирование системы безопасности показывает вам, что существует мост? И что еще более важно, делаете ли вы это вручную? Вы переходите от одной зависимости к другой, а затем проверяете ее и периодически обновляете? Или у вас есть какая-то автоматизация?

Как насчет того, чтобы создать систему, которая будет создавать pull request с обновлениями для всех ваших зависимостей? А затем вы сможете выбрать – хотите ли вы обновить их все или некоторые из них. Это зависит только от вас.

Именно об этом идет речь в этом видео.

Давайте посмотрим, как мы можем сделать это используя renovate.

Давайте взглянем на простой проект, который у меня есть. У меня файлы Go. У меня есть Dockerfile для создания образа контейнеров. И у меня есть каталог k8s, где хранятся мои манифесты Kubernetes. 

Все очень просто, насколько это вообще возможно.

Теперь в коде Go могут быть некоторые зависимости, которые могут быть актуальными, а, может быть, и нет.

В Dockerfile тоже могут быть некоторые зависимости. И в моих манифестах Kubernetes они тоже могут быть. Давайте посмотрим, смогу ли я быть в курсе всех зависимостей, которые у меня есть в этом крошечном проекте.

Репозиторий, о котором идет речь, то самое, в котором хранятся файлы, называется «Renovate». 

Я сейчас его выберу и нажму на кнопку «Сохранить». Это все, что мне нужно сделать до тех пор, пока не начнется обновление, которое даст мне возможность выбрать то, что я хочу обновить, а что нет. Нажимайте на кнопку «Сохранить».

Я получил письмо по электронной почте. Давайте посмотрим, что находится внутри этого письма. Письмо пришло от Renovate, в котором говорится: У тебя появилось новый репозиторий, за которым я слежу за тебя. 

Вот, что ты можешь с ним сделать, вот что произойдет в будущем». Это ознакомительное электронное письмо. Вам следует его прочесть. Я уже прочитал это письмо, так что я собираюсь двигаться дальше.

Двигаясь дальше, нажмите на ссылку с pull request, которое Renovate создала для нас. В электронном письме содержиться pull request.

Давайте зайдем в раздел PR и посмотрим, что у нас там есть.

По сути дела, здесь говорится следующее: «У вас есть два типа обнаруженных файлов. Один из них относится к Dockerfile, а другой к Go. Это будет работать и с другими языками».

Renovate работает практически с чем угодно.

Как ни странно, она не обнаружила мои манифесты Kubernetes, но мы вернемся к этому позже.

Давайте взглянем на файлы, которые были изменены с помощью этого pull request.

https://github.com/vfarcic/codespaces-gitpod-okteto-demo/blob/main/renovate.json

На самом деле существует только один способ обновления файла. Используйте формат json. 

Это настолько просто, насколько это возможно. В нем говорится, что он должен начать использовать программу Renovate и расширить базовую конфигурацию.

Большинству из нас достаточны настройки по умолчанию. В этом и заключается одна из прелестей программы Renovate. Renovate просто работает из коробки работает довольно хорошо. И опытные пользователи могут настроить ее в соответствии со своими собственными желаниями. Для многих из нас нет необходимости что-либо менять.

Позвольте мне смержить этот Pull request и пусть pipeline запустится. Давайте посмотрим, что у них получится.

Через несколько минут у меня появилась новая issue. Это не то же самое, что и другие проблемы, которые вы открываете на GitHub. Это Dashboard. Так что это issue должна быть открыта постоянно. Renovate обновит эту issue, предоставив вам сводную информацию обо всех других обновлениях всех других pull request, которые она создаст для нас.
Поступило два pull request.

Один из них относится к библиотекам Go, а другой к Dockerfile. Так что первый pull request, который я открою, будет касаться Dockerfile. Я смогу увидеть краткое изложение и всю информацию, которая мне может понадобиться и т. д. Это очень информативно.

Мы можем видеть, что это изменило базовые образы.

В моем Dockerfile использовался Golang 1.17, а текущая версия 1.18. В pull request в файле Dockerfile меняется Golang 1.17 на 1.18. 
И все, что мне нужно сделать, это принять этот pull request, чтобы объединить его с основной веткой. 
И тогда любые pipeline, которые у меня есть, запустятся и создадут новый образ в этом случае, потому что Dockerfile изменился.

Golang:

А второй pull request касается зависимости Go. И процесс по-прежнему остается тем же самым.
У меня есть краткое изложение всех изменений в описании pull request. У меня есть примечание к выпуску и т. д. Я это тоже пропущу и сразу перейду к файлам, в которых были внесены изменения.

В результате была изменена только одна зависимость. Но давайте посмотрим, так ли это на самом деле.

А затем я перешел к различиям между тем, что было раньше и сейчас, сейчас и потом, и т. д. 

Только посмотрите на это. Это не простое изменение зависимости. Это действительно изменило одну из этих зависимостей. Но у этой зависимости есть и другие подзависимости, так что это изменило их все.

Renovate сделал это разумно, понимая, что существуют зависимости от зависимостей и т. д. 

Поэтому Renovate изменил файл go.mod, который содержит основные зависимости, изменил файл go.sum, который содержит все хэши всех конкретных зависимостей. 

Так что это изменило все разумно, а не просто слепо повлияло на одну из зависимостей.

Kubernetes:

Так как манифесты Kubernetes могут быть практически в любом yaml (и в json) файле,  то необходимо указать Renovate где искать манифесты Kubernetes.

И мне придется помочь в обновлении, сказав ему: «В этом конкретном каталоге содержится манифесты Kubernetes». Именно это я и собираюсь сделать.

https://github.com/vfarcic/codespaces-gitpod-okteto-demo/blob/main/renovate.json

А затем я подожду несколько минут. И смогу вернуться к этой проблеме, к панели мониторинга, которая хранится в проблеме. И мы увидим, что Dashboard изменился. Теперь там написано: «Все зависимости, которые у тебя были раньше, исправлены. Но теперь у тебя возникла проблема в одном из манифестов Kubernetes».

Если быть более точным, было обнаружено, что тег образа, который я использовал, не является последним. И все, что мне нужно сделать, это нажать на эту ссылку, которая приведет меня к pull request информации.

А внутри этого pull request у меня есть краткое изложение или вся информация о том, что происходит.

И я могу перейти к разделу «Изменения в файлах», чтобы просмотреть изменения в файлах и подробную информацию о том, что предлагает мне сделать программа Renovate.

И это предложение относительно простое: «Образ было вот таким». Теперь должно получиться так, что если вы объедините этот pull request, то получите тег образа, который вы используете в манифесте развертывания Kubernetes.

Так что я доверяю программе Renovate. Я просто собираюсь объединить этот pull request данных воедино. И на этом все должно закончиться.

И также у нас есть языки, которые она поддерживает. На самом деле это не совсем языки: Bazel, Docker, Golang, Java, JavaScript, Node, Nuget, PHP, Python, Ruby.

Есть еще один важный вопрос: «А сколько это стоит? Сколько нужно заплатить, чтобы воспользоваться услугой Renovate?». У нас хорошие новости. Если вы занимаетесь проектом с открытым исходным кодом, то это абсолютно бесплатно. Если вы пользуетесь GitHub, то это тоже бесплатно. Если это самостоятельный проект, то он все равно остается бесплатным. Вам нужно получить лицензию на самостоятельный хостинг.

Я не использую самостоятельные компоненты, так что я не совсем уверен, что значит получить лицензию бесплатно, но это должно быть бесплатно, я уверен. В любом случае цена настолько хороша, насколько это возможно. Она равна нулю.

И если Renovate будет продолжать расти, то именно это мы вероятно увидим в недалеком будущем. Я на это надеюсь. Так что этот негативный момент на самом деле не является негативным. Здесь есть все возможности для совершенствования и расширения сферы применения.

Это просто работает. Все работает из коробки. Вы говорите: «Я хочу, чтобы ты управлял этим хранилищем». И в большинстве случаев все будет сделано правильно, даже если я ничего не буду предпринимать.

А если он будет делать не совсем то, что я хочу, я легко могу расширить его с помощью обновления json. Я могу точно настроить то, что он делает. Так что все работает так, как надо. Это просто работает. И поведение по умолчанию – это то, что действительно работает для большинства людей. Он очень легко настраивается, а цена у него самая подходящая – нулевая.

И позвольте дать вам рекомендацию: не полагайтесь только на Renovate. Renovate не позволит вам объединять pull request с основной линией всякий раз, когда происходит обновление.

Вам все равно нужны конвейеры, которые будут тестировать эти изменения и гарантировать, что все работает. Так что программа обновления дополняет вашу автоматизацию. Она гарантирует, что у вас будут pull request с обновлением ваших зависимостей или чего-то еще, чем она управляет. Она не заменяет собой вашу автоматизацию. Так что убедитесь, что вы тестируете свои обновления до того, как действительно примените их в производстве. 
